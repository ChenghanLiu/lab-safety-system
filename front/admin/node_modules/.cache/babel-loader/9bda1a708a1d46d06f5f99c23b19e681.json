{"remainingRequest":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/babel-loader/lib/index.js!/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liuchenghan/Desktop/lab-safety-system/front/admin/src/views/home.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/src/views/home.vue","mtime":1771501288054},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/babel.config.js","mtime":1739263804000},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/cache-loader/dist/cjs.js","mtime":1771254462036},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/babel-loader/lib/index.js","mtime":1771254462371},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/cache-loader/dist/cjs.js","mtime":1771254462036},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/vue-loader/lib/index.js","mtime":1771254462450}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWdlbmVyYXRvciBmcm9tICIvVXNlcnMvbGl1Y2hlbmdoYW4vRGVza3RvcC9sYWItc2FmZXR5LXN5c3RlbS9mcm9udC9hZG1pbi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vcmVnZW5lcmF0b3IuanMiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiL1VzZXJzL2xpdWNoZW5naGFuL0Rlc2t0b3AvbGFiLXNhZmV0eS1zeXN0ZW0vZnJvbnQvYWRtaW4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIjsKaW1wb3J0IHJvdXRlciBmcm9tICJAL3JvdXRlci9yb3V0ZXItc3RhdGljIjsKaW1wb3J0IGh0dHAgZnJvbSAiQC91dGlscy9odHRwIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJIb21lIiwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIHVzZXI6IG51bGwKICAgIH07CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdGhpcy5pbml0KCkuY2F0Y2goZnVuY3Rpb24gKCkge30pOwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHJvbGU6IGZ1bmN0aW9uIHJvbGUoKSB7CiAgICAgIHJldHVybiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oIlJvbGUiKSB8fCAiIikudHJpbSgpLnRvVXBwZXJDYXNlKCk7CiAgICB9LAogICAgaXNBZG1pbjogZnVuY3Rpb24gaXNBZG1pbigpIHsKICAgICAgcmV0dXJuIHRoaXMucm9sZSA9PT0gIkFETUlOIiB8fCB0aGlzLnJvbGUgPT09ICJST0xFX0FETUlOIjsKICAgIH0sCiAgICBpc1RlYWNoZXI6IGZ1bmN0aW9uIGlzVGVhY2hlcigpIHsKICAgICAgcmV0dXJuIHRoaXMucm9sZSA9PT0gIlRFQUNIRVIiIHx8IHRoaXMucm9sZSA9PT0gIlJPTEVfVEVBQ0hFUiI7CiAgICB9LAogICAgaXNTdHVkZW50OiBmdW5jdGlvbiBpc1N0dWRlbnQoKSB7CiAgICAgIHJldHVybiB0aGlzLnJvbGUgPT09ICJTVFVERU5UIiB8fCB0aGlzLnJvbGUgPT09ICJST0xFX1NUVURFTlQiOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3IoKS5tKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIHRva2VuOwogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IoKS53KGZ1bmN0aW9uIChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQubikgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgdG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiVG9rZW4iKTsKICAgICAgICAgICAgICBpZiAodG9rZW4pIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm4gPSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJvdXRlci5yZXBsYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJsb2dpbiIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYSgyKTsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIF9jb250ZXh0Lm4gPSAyOwogICAgICAgICAgICAgIHJldHVybiBfdGhpcy5mZXRjaFNlc3Npb24oKTsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hKDIpOwogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBmZXRjaFNlc3Npb246IGZ1bmN0aW9uIGZldGNoU2Vzc2lvbigpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yKCkubShmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgcmVzLCBkYXRhLCBfdDsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yKCkudyhmdW5jdGlvbiAoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDIucCA9IF9jb250ZXh0Mi5uKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfdGhpczIubG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgX2NvbnRleHQyLnAgPSAxOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uID0gMjsKICAgICAgICAgICAgICByZXR1cm4gaHR0cCh7CiAgICAgICAgICAgICAgICB1cmw6ICIvYXBpL3Nlc3Npb24iLAogICAgICAgICAgICAgICAgbWV0aG9kOiAiR0VUIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQyLnY7CiAgICAgICAgICAgICAgZGF0YSA9IHJlcyAmJiByZXMuZGF0YSA/IHJlcy5kYXRhIDogbnVsbDsKICAgICAgICAgICAgICBfdGhpczIudXNlciA9IGRhdGE7CgogICAgICAgICAgICAgIC8vIOKchSDlhbPplK7vvJrlhpnlhaXop5LoibLkvpvoj5zljZXkvb/nlKgKICAgICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLnJvbGUpIHsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJSb2xlIiwgZGF0YS5yb2xlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgX2NvbnRleHQyLm4gPSA0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnAgPSAzOwogICAgICAgICAgICAgIF90ID0gX2NvbnRleHQyLnY7CiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oIlRva2VuIik7CiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oIlJvbGUiKTsKICAgICAgICAgICAgICByb3V0ZXIucmVwbGFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAibG9naW4iCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBfY29udGV4dDIucCA9IDQ7CiAgICAgICAgICAgICAgX3RoaXMyLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmYoNCk7CiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmEoMik7CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIG51bGwsIFtbMSwgMywgNCwgNV1dKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgcmVsb2FkOiBmdW5jdGlvbiByZWxvYWQoKSB7CiAgICAgIHRoaXMuZmV0Y2hTZXNzaW9uKCkuY2F0Y2goZnVuY3Rpb24gKCkge30pOwogICAgfSwKICAgIGdvVXBkYXRlUGFzc3dvcmQ6IGZ1bmN0aW9uIGdvVXBkYXRlUGFzc3dvcmQoKSB7CiAgICAgIHJvdXRlci5wdXNoKHsKICAgICAgICBwYXRoOiAiL3VwZGF0ZVBhc3N3b3JkIgogICAgICB9KTsKICAgIH0sCiAgICBsb2dvdXQ6IGZ1bmN0aW9uIGxvZ291dCgpIHsKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oIlRva2VuIik7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJSb2xlIik7CiAgICAgIHRoaXMudXNlciA9IG51bGw7CiAgICAgIHJvdXRlci5yZXBsYWNlKHsKICAgICAgICBuYW1lOiAibG9naW4iCiAgICAgIH0pOwogICAgfSwKICAgIHJvbGVUZXh0OiBmdW5jdGlvbiByb2xlVGV4dChyb2xlKSB7CiAgICAgIHZhciByID0gU3RyaW5nKHJvbGUgfHwgIiIpLnRvVXBwZXJDYXNlKCk7CiAgICAgIGlmIChyID09PSAiQURNSU4iKSByZXR1cm4gIueuoeeQhuWRmCI7CiAgICAgIGlmIChyID09PSAiVEVBQ0hFUiIpIHJldHVybiAi5pWZ5biIIjsKICAgICAgaWYgKHIgPT09ICJTVFVERU5UIikgcmV0dXJuICLlrabnlJ8iOwogICAgICByZXR1cm4gcm9sZSB8fCAiLSI7CiAgICB9CiAgfQp9Ow=="},{"version":3,"names":["router","http","name","data","loading","user","mounted","init","catch","computed","role","localStorage","getItem","trim","toUpperCase","isAdmin","isTeacher","isStudent","methods","_this","_asyncToGenerator","_regenerator","m","_callee","token","w","_context","n","replace","a","fetchSession","_this2","_callee2","res","_t","_context2","p","url","method","v","setItem","removeItem","f","reload","goUpdatePassword","push","path","logout","roleText","r","String"],"sources":["src/views/home.vue"],"sourcesContent":["<template>\r\n  <div class=\"home\">\r\n    <el-card class=\"card\" shadow=\"never\" v-loading=\"loading\">\r\n      <div class=\"title\">个人信息</div>\r\n\r\n      <div v-if=\"user\" class=\"content\">\r\n        <div class=\"welcome\">\r\n          欢迎你，\r\n          <span class=\"strong\">{{ user.username }}</span>\r\n          <span class=\"role\">（{{ roleText(user.role) }}）</span>\r\n        </div>\r\n\r\n        <el-divider></el-divider>\r\n\r\n        <el-descriptions :column=\"1\" border>\r\n          <el-descriptions-item label=\"用户ID\">\r\n            {{ user.id }}\r\n          </el-descriptions-item>\r\n          <el-descriptions-item label=\"用户名\">\r\n            {{ user.username }}\r\n          </el-descriptions-item>\r\n          <el-descriptions-item label=\"邮箱\">\r\n            {{ user.email || '-' }}\r\n          </el-descriptions-item>\r\n          <el-descriptions-item label=\"角色\">\r\n            {{ roleText(user.role) }}\r\n          </el-descriptions-item>\r\n        </el-descriptions>\r\n\r\n        <div class=\"actions\">\r\n          <el-button type=\"primary\" @click=\"goUpdatePassword\">\r\n            修改密码\r\n          </el-button>\r\n\r\n          <el-button @click=\"reload\" :disabled=\"loading\">\r\n            刷新\r\n          </el-button>\r\n\r\n          <el-button type=\"danger\" @click=\"logout\">\r\n            退出登录\r\n          </el-button>\r\n        </div>\r\n      </div>\r\n\r\n      <div v-else class=\"empty\">\r\n        <div class=\"empty-text\">未获取到用户信息</div>\r\n        <el-button type=\"danger\" @click=\"logout\">\r\n          返回登录页\r\n        </el-button>\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport router from \"@/router/router-static\";\r\nimport http from \"@/utils/http\";\r\n\r\nexport default {\r\n  name: \"Home\",\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      user: null\r\n    };\r\n  },\r\n\r\n  mounted() {\r\n    this.init().catch(() => {});\r\n  },\r\n\r\n  computed: {\r\n    role() {\r\n      return (localStorage.getItem(\"Role\") || \"\").trim().toUpperCase();\r\n    },\r\n    isAdmin() {\r\n      return this.role === \"ADMIN\" || this.role === \"ROLE_ADMIN\";\r\n    },\r\n    isTeacher() {\r\n      return this.role === \"TEACHER\" || this.role === \"ROLE_TEACHER\";\r\n    },\r\n    isStudent() {\r\n      return this.role === \"STUDENT\" || this.role === \"ROLE_STUDENT\";\r\n    }\r\n  },\r\n\r\n\r\n  methods: {\r\n    async init() {\r\n      const token = localStorage.getItem(\"Token\");\r\n      if (!token) {\r\n        router.replace({ name: \"login\" });\r\n        return;\r\n      }\r\n      await this.fetchSession();\r\n    },\r\n\r\n    async fetchSession() {\r\n      this.loading = true;\r\n      try {\r\n        const res = await http({\r\n          url: \"/api/session\",\r\n          method: \"GET\"\r\n        });\r\n\r\n        const data = res && res.data ? res.data : null;\r\n        this.user = data;\r\n\r\n        // ✅ 关键：写入角色供菜单使用\r\n        if (data && data.role) {\r\n          localStorage.setItem(\"Role\", data.role);\r\n        }\r\n\r\n      } catch (e) {\r\n        localStorage.removeItem(\"Token\");\r\n        localStorage.removeItem(\"Role\");\r\n        router.replace({ name: \"login\" });\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n\r\n    reload() {\r\n      this.fetchSession().catch(() => {});\r\n    },\r\n\r\n    goUpdatePassword() {\r\n      router.push({ path: \"/updatePassword\" });\r\n    },\r\n\r\n    logout() {\r\n      localStorage.removeItem(\"Token\");\r\n      localStorage.removeItem(\"Role\");\r\n      this.user = null;\r\n      router.replace({ name: \"login\" });\r\n    },\r\n\r\n    roleText(role) {\r\n      const r = String(role || \"\").toUpperCase();\r\n      if (r === \"ADMIN\") return \"管理员\";\r\n      if (r === \"TEACHER\") return \"教师\";\r\n      if (r === \"STUDENT\") return \"学生\";\r\n      return role || \"-\";\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.home {\r\n  padding: 16px;\r\n}\r\n.card {\r\n  max-width: 820px;\r\n}\r\n.title {\r\n  font-size: 18px;\r\n  font-weight: 600;\r\n  margin-bottom: 12px;\r\n}\r\n.welcome {\r\n  font-size: 16px;\r\n  line-height: 24px;\r\n}\r\n.strong {\r\n  font-weight: 700;\r\n}\r\n.role {\r\n  color: #666;\r\n  margin-left: 6px;\r\n}\r\n.actions {\r\n  margin-top: 16px;\r\n  display: flex;\r\n  gap: 10px;\r\n  flex-wrap: wrap;\r\n}\r\n.empty-text {\r\n  margin-bottom: 12px;\r\n  color: #999;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]}]}