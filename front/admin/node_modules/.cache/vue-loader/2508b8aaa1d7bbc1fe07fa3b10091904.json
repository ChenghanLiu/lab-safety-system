{"remainingRequest":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liuchenghan/Desktop/lab-safety-system/front/admin/src/views/modules/equipment/list.vue?vue&type=style&index=0&id=602f7721&scoped=true&lang=css","dependencies":[{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/src/views/modules/equipment/list.vue","mtime":1771341101508},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/css-loader/dist/cjs.js","mtime":1771254462222},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1771254462650},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/postcss-loader/src/index.js","mtime":1771254462334},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/cache-loader/dist/cjs.js","mtime":1771254462036},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/vue-loader/lib/index.js","mtime":1771254462450}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5wYWdlIHsKICBwYWRkaW5nOiAxNnB4Owp9Ci50b29sYmFyIHsKICBtYXJnaW4tYm90dG9tOiAxMnB4Owp9Ci5yb3cgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgZ2FwOiAxMnB4Owp9Ci5sZWZ0IHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgZ2FwOiAxMHB4OwogIGZsZXgtd3JhcDogd3JhcDsKfQoucmlnaHQgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDEwcHg7Cn0KLnBhZ2VyIHsKICBtYXJnaW4tdG9wOiAxMnB4OwogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDsKfQo="},{"version":3,"sources":["list.vue"],"names":[],"mappings":";AAuWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/modules/equipment","sourcesContent":["<template>\n  <div class=\"page\">\n    <!-- 工具栏 -->\n    <el-card shadow=\"never\" class=\"toolbar\">\n      <div class=\"row\">\n        <div class=\"left\">\n          <el-input\n              v-model.trim=\"searchId\"\n              placeholder=\"按设备ID搜索（例如 5）\"\n              clearable\n              style=\"width: 260px\"\n              @keyup.enter.native=\"onSearch\"\n          />\n          <el-button type=\"primary\" @click=\"onSearch\">搜索</el-button>\n          <el-button @click=\"onReset\">重置</el-button>\n        </div>\n\n        <div class=\"right\">\n          <el-button type=\"success\" @click=\"openCreate\">新增设备</el-button>\n        </div>\n      </div>\n    </el-card>\n\n    <!-- 表格 -->\n    <el-card shadow=\"never\">\n      <el-table\n          :data=\"rows\"\n          border\n          stripe\n          v-loading=\"loading\"\n          style=\"width: 100%\"\n      >\n        <el-table-column prop=\"id\" label=\"ID\" width=\"80\" />\n        <el-table-column prop=\"labName\" label=\"实验室\" min-width=\"160\" />\n        <el-table-column prop=\"category\" label=\"分类\" min-width=\"120\" />\n        <el-table-column prop=\"name\" label=\"设备名称\" min-width=\"160\" />\n        <el-table-column prop=\"model\" label=\"型号\" min-width=\"120\" />\n        <el-table-column prop=\"quantity\" label=\"数量\" width=\"80\" />\n        <el-table-column prop=\"status\" label=\"状态\" width=\"120\" />\n        <el-table-column prop=\"storageLocation\" label=\"存放位置\" min-width=\"140\" />\n\n        <el-table-column label=\"操作\" width=\"220\" fixed=\"right\">\n          <template slot-scope=\"{ row }\">\n            <el-button type=\"primary\" size=\"mini\" @click=\"openEdit(row)\">\n              编辑\n            </el-button>\n            <el-button type=\"danger\" size=\"mini\" @click=\"onDelete(row)\">\n              删除\n            </el-button>\n            <!-- 预约后面加：学生点“预约”弹窗 -->\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <!-- 分页 -->\n      <div class=\"pager\">\n        <el-pagination\n            background\n            layout=\"total, sizes, prev, pager, next, jumper\"\n            :total=\"total\"\n            :page-size=\"pageSize\"\n            :current-page=\"page + 1\"\n            :page-sizes=\"[10, 20, 50, 100]\"\n            @current-change=\"onPageChange\"\n            @size-change=\"onSizeChange\"\n        />\n      </div>\n    </el-card>\n\n    <!-- 新增/编辑弹窗 -->\n    <el-dialog\n        :title=\"dialogMode === 'create' ? '新增设备' : '编辑设备'\"\n        :visible.sync=\"dialogVisible\"\n        width=\"720px\"\n        :close-on-click-modal=\"false\"\n    >\n      <el-form\n          ref=\"form\"\n          :model=\"form\"\n          :rules=\"rules\"\n          label-width=\"110px\"\n      >\n        <el-form-item label=\"实验室ID\" prop=\"labId\">\n          <el-input v-model.number=\"form.labId\" placeholder=\"例如 4\" />\n        </el-form-item>\n\n        <el-form-item label=\"分类\" prop=\"category\">\n          <el-input v-model.trim=\"form.category\" placeholder=\"例如 Microscope\" />\n        </el-form-item>\n\n        <el-form-item label=\"设备名称\" prop=\"name\">\n          <el-input v-model.trim=\"form.name\" placeholder=\"设备名称\" />\n        </el-form-item>\n\n        <el-form-item label=\"型号\">\n          <el-input v-model.trim=\"form.model\" placeholder=\"可选\" />\n        </el-form-item>\n\n        <el-form-item label=\"规格\">\n          <el-input v-model.trim=\"form.specification\" placeholder=\"可选\" />\n        </el-form-item>\n\n        <el-form-item label=\"数量\" prop=\"quantity\">\n          <el-input v-model.number=\"form.quantity\" placeholder=\"例如 3\" />\n        </el-form-item>\n\n        <el-form-item label=\"购置日期\">\n          <el-date-picker\n              v-model=\"form.purchaseDate\"\n              type=\"date\"\n              value-format=\"yyyy-MM-dd\"\n              placeholder=\"选择日期\"\n              style=\"width: 100%\"\n          />\n        </el-form-item>\n\n        <el-form-item label=\"存放位置\">\n          <el-input v-model.trim=\"form.storageLocation\" placeholder=\"可选\" />\n        </el-form-item>\n\n        <el-form-item label=\"状态\" prop=\"status\">\n          <el-select v-model=\"form.status\" placeholder=\"请选择\">\n            <el-option label=\"AVAILABLE\" value=\"AVAILABLE\" />\n            <el-option label=\"IN_USE\" value=\"IN_USE\" />\n            <el-option label=\"MAINTENANCE\" value=\"MAINTENANCE\" />\n            <el-option label=\"UNAVAILABLE\" value=\"UNAVAILABLE\" />\n          </el-select>\n        </el-form-item>\n\n        <el-form-item label=\"描述\">\n          <el-input\n              v-model.trim=\"form.description\"\n              type=\"textarea\"\n              :rows=\"3\"\n              placeholder=\"可选\"\n          />\n        </el-form-item>\n      </el-form>\n\n      <span slot=\"footer\">\n        <el-button @click=\"dialogVisible = false\">取消</el-button>\n        <el-button type=\"primary\" :loading=\"saving\" @click=\"onSave\">保存</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport {\n  listEquipment,\n  getEquipmentById,\n  createEquipment,\n  updateEquipment,\n  deleteEquipment\n} from \"@/api/equipment\";\n\nexport default {\n  name: \"EquipmentList\",\n  data() {\n    return {\n      // 列表\n      loading: false,\n      rows: [],\n      total: 0,\n      page: 0,\n      pageSize: 10,\n\n      // 搜索\n      searchId: \"\",\n\n      // 弹窗\n      dialogVisible: false,\n      dialogMode: \"create\", // create | edit\n      saving: false,\n      editingId: null,\n\n      form: this.emptyForm(),\n      rules: {\n        labId: [{ required: true, message: \"请输入实验室ID\", trigger: \"blur\" }],\n        category: [{ required: true, message: \"请输入分类\", trigger: \"blur\" }],\n        name: [{ required: true, message: \"请输入设备名称\", trigger: \"blur\" }],\n        quantity: [{ required: true, message: \"请输入数量\", trigger: \"blur\" }],\n        status: [{ required: true, message: \"请选择状态\", trigger: \"change\" }]\n      }\n    };\n  },\n  mounted() {\n    this.fetchList().catch(() => {});\n  },\n  methods: {\n    emptyForm() {\n      return {\n        labId: null,\n        category: \"\",\n        name: \"\",\n        model: \"\",\n        specification: \"\",\n        quantity: null,\n        purchaseDate: \"\",\n        storageLocation: \"\",\n        status: \"AVAILABLE\",\n        description: \"\"\n      };\n    },\n\n    async fetchList() {\n      this.loading = true;\n      try {\n        const res = await listEquipment({ page: this.page, size: this.pageSize });\n        const data = res && res.data ? res.data : {};\n        this.rows = data.content || [];\n        this.total = Number(data.totalElements || 0);\n      } catch (e) {\n        this.$message.error(\"获取设备列表失败\");\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    async fetchById(id) {\n      this.loading = true;\n      try {\n        const res = await getEquipmentById(id);\n        const item = res && res.data ? res.data : null;\n        this.rows = item ? [item] : [];\n        this.total = item ? 1 : 0;\n      } catch (e) {\n        this.rows = [];\n        this.total = 0;\n        this.$message.error(\"未找到该设备或无权限\");\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    onSearch() {\n      const v = (this.searchId || \"\").trim();\n      if (!v) {\n        this.onReset();\n        return;\n      }\n      if (!/^\\d+$/.test(v)) {\n        this.$message.warning(\"设备ID只能是数字\");\n        return;\n      }\n      this.fetchById(Number(v)).catch(() => {});\n    },\n\n    onReset() {\n      this.searchId = \"\";\n      this.page = 0;\n      this.fetchList().catch(() => {});\n    },\n\n    onPageChange(p) {\n      this.page = p - 1;\n      this.fetchList().catch(() => {});\n    },\n\n    onSizeChange(s) {\n      this.pageSize = s;\n      this.page = 0;\n      this.fetchList().catch(() => {});\n    },\n\n    openCreate() {\n      this.dialogMode = \"create\";\n      this.editingId = null;\n      this.form = this.emptyForm();\n      this.dialogVisible = true;\n      this.$nextTick(() => {\n        this.$refs.form && this.$refs.form.clearValidate();\n      });\n    },\n\n    openEdit(row) {\n      this.dialogMode = \"edit\";\n      this.editingId = row.id;\n\n      // 只映射后端需要的字段\n      this.form = {\n        labId: row.labId,\n        category: row.category,\n        name: row.name,\n        model: row.model || \"\",\n        specification: row.specification || \"\",\n        quantity: row.quantity,\n        purchaseDate: row.purchaseDate || \"\",\n        storageLocation: row.storageLocation || \"\",\n        status: row.status || \"AVAILABLE\",\n        description: row.description || \"\"\n      };\n\n      this.dialogVisible = true;\n      this.$nextTick(() => {\n        this.$refs.form && this.$refs.form.clearValidate();\n      });\n    },\n\n    onSave() {\n      this.$refs.form.validate((ok) => {\n        if (!ok) return;\n        this.save().catch(() => {});\n      });\n    },\n\n    async save() {\n      if (this.saving) return;\n      this.saving = true;\n\n      try {\n        if (this.dialogMode === \"create\") {\n          await createEquipment(this.form);\n          this.$message.success(\"新增成功\");\n        } else {\n          await updateEquipment(this.editingId, this.form);\n          this.$message.success(\"修改成功\");\n        }\n\n        this.dialogVisible = false;\n\n        // 保存后回到列表\n        this.searchId = \"\";\n        await this.fetchList();\n      } catch (e) {\n        this.$message.error(\"保存失败（可能无权限）\");\n      } finally {\n        this.saving = false;\n      }\n    },\n\n    onDelete(row) {\n      this.$confirm(`确认删除设备 ID=${row.id} 吗？`, \"提示\", {\n        type: \"warning\"\n      })\n          .then(() => this.doDelete(row.id))\n          .catch(() => {});\n    },\n\n    async doDelete(id) {\n      try {\n        await deleteEquipment(id);\n        this.$message.success(\"删除成功\");\n\n        // 删除后刷新当前列表\n        if ((this.searchId || \"\").trim()) {\n          this.searchId = \"\";\n          this.page = 0;\n        }\n        await this.fetchList();\n      } catch (e) {\n        this.$message.error(\"删除失败（可能无权限）\");\n      }\n    }\n  }\n};\n</script>\n\n<style scoped>\n.page {\n  padding: 16px;\n}\n.toolbar {\n  margin-bottom: 12px;\n}\n.row {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n}\n.left {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex-wrap: wrap;\n}\n.right {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n.pager {\n  margin-top: 12px;\n  display: flex;\n  justify-content: flex-end;\n}\n</style>\n"]}]}