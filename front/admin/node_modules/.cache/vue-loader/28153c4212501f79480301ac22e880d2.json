{"remainingRequest":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liuchenghan/Desktop/lab-safety-system/front/admin/src/views/modules/user/list.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/src/views/modules/user/list.vue","mtime":1771499449810},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/cache-loader/dist/cjs.js","mtime":1771254462036},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/babel-loader/lib/index.js","mtime":1771254462371},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/cache-loader/dist/cjs.js","mtime":1771254462036},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/vue-loader/lib/index.js","mtime":1771254462450}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7CiAgbGlzdFVzZXJzLAogIGdldFVzZXJCeUlkLAogIGNyZWF0ZVVzZXIsCiAgdXBkYXRlVXNlciwKICBkZWxldGVVc2VyCn0gZnJvbSAiQC9hcGkvdXNlciI7CgpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICByb3dzOiBbXSwKICAgICAgdG90YWw6IDAsCiAgICAgIHBhZ2U6IDEsCiAgICAgIHNpemU6IDEwLAoKICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgIGRpYWxvZ1RpdGxlOiAiIiwKICAgICAgaXNFZGl0OiBmYWxzZSwKICAgICAgZWRpdElkOiBudWxsLAoKICAgICAgZm9ybTogewogICAgICAgIHVzZXJuYW1lOiAiIiwKICAgICAgICBlbWFpbDogIiIsCiAgICAgICAgcGFzc3dvcmQ6ICIiLAogICAgICAgIHJvbGU6ICJTVFVERU5UIgogICAgICB9CiAgICB9OwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICByb2xlKCkgewogICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oIlJvbGUiKSB8fCAiIjsKICAgIH0sCiAgICBpc0FkbWluKCkgewogICAgICByZXR1cm4gdGhpcy5yb2xlID09PSAiQURNSU4iOwogICAgfQogIH0sCgogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmxvYWQoKTsKICB9LAoKICBtZXRob2RzOiB7CiAgICBhc3luYyBsb2FkKCkgewogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGxpc3RVc2Vycyh7CiAgICAgICAgICBwYWdlOiB0aGlzLnBhZ2UgLSAxLAogICAgICAgICAgc2l6ZTogdGhpcy5zaXplCiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IGRhdGEgPSByZXMuZGF0YSB8fCB7fTsKICAgICAgICB0aGlzLnJvd3MgPSBkYXRhLmNvbnRlbnQgfHwgW107CiAgICAgICAgdGhpcy50b3RhbCA9IE51bWJlcihkYXRhLnRvdGFsRWxlbWVudHMgfHwgMCk7CgogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc3QgbXNnID0gZT8ucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2UgfHwgZT8ubWVzc2FnZSB8fCAi5Yqg6L295aSx6LSlIjsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLnlKjmiLfliJfooajliqDovb3lpLHotKXvvJoiICsgbXNnKTsKICAgICAgICB0aGlzLnJvd3MgPSBbXTsKICAgICAgICB0aGlzLnRvdGFsID0gMDsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIGZvcm1hdFJvbGUocm9sZSkgewogICAgICBjb25zdCBtYXAgPSB7CiAgICAgICAgQURNSU46ICLnrqHnkIblkZgiLAogICAgICAgIFRFQUNIRVI6ICLmlZnluIgiLAogICAgICAgIFNUVURFTlQ6ICLlrabnlJ8iCiAgICAgIH07CiAgICAgIHJldHVybiBtYXBbcm9sZV0gfHwgcm9sZTsKICAgIH0sCgoKICAgIGNoYW5nZVBhZ2UocCkgewogICAgICB0aGlzLnBhZ2UgPSBwOwogICAgICB0aGlzLmxvYWQoKTsKICAgIH0sCgogICAgY2hhbmdlU2l6ZShzKSB7CiAgICAgIHRoaXMuc2l6ZSA9IHM7CiAgICAgIHRoaXMucGFnZSA9IDE7CiAgICAgIHRoaXMubG9hZCgpOwogICAgfSwKCiAgICBvcGVuQ3JlYXRlKCkgewogICAgICB0aGlzLmRpYWxvZ1RpdGxlID0gIuaWsOWinueUqOaIt++8iEFkbWlu77yJIjsKICAgICAgdGhpcy5pc0VkaXQgPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0SWQgPSBudWxsOwogICAgICB0aGlzLmZvcm0gPSB7CiAgICAgICAgdXNlcm5hbWU6ICIiLAogICAgICAgIGVtYWlsOiAiIiwKICAgICAgICBwYXNzd29yZDogIiIsCiAgICAgICAgcm9sZTogIlNUVURFTlQiCiAgICAgIH07CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7CiAgICB9LAoKICAgIGFzeW5jIG9wZW5FZGl0KGlkKSB7CiAgICAgIHRoaXMuZGlhbG9nVGl0bGUgPSAi57yW6L6R55So5oi377yIQWRtaW7vvIkiOwogICAgICB0aGlzLmlzRWRpdCA9IHRydWU7CiAgICAgIHRoaXMuZWRpdElkID0gaWQ7CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7CgogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGdldFVzZXJCeUlkKGlkKTsKICAgICAgICBjb25zdCB1ID0gcmVzLmRhdGEgfHwge307CiAgICAgICAgdGhpcy5mb3JtID0gewogICAgICAgICAgdXNlcm5hbWU6IHUudXNlcm5hbWUgfHwgIiIsIC8vIOe8lui+keaXtuS4jeaUuSB1c2VybmFtZe+8jOS9huS/neeVmeaYvuekuueUqAogICAgICAgICAgZW1haWw6IHUuZW1haWwgfHwgIiIsCiAgICAgICAgICBwYXNzd29yZDogIiIsCiAgICAgICAgICByb2xlOiB1LnJvbGUgfHwgIlNUVURFTlQiCiAgICAgICAgfTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuWKoOi9veeUqOaIt+S/oeaBr+Wksei0pSIpOwogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIHN1Ym1pdCgpIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoIXRoaXMuaXNBZG1pbikgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5peg5p2D6ZmQIik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5pc0VkaXQpIHsKICAgICAgICAgIC8vIOaMieS9oOWQjuerr++8mnB1dCBib2R5IOWPr+WMheWQqyBlbWFpbC9yb2xlL3Bhc3N3b3JkCiAgICAgICAgICBjb25zdCBwYXlsb2FkID0gewogICAgICAgICAgICBlbWFpbDogdGhpcy5mb3JtLmVtYWlsLAogICAgICAgICAgICByb2xlOiB0aGlzLmZvcm0ucm9sZSwKICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMuZm9ybS5wYXNzd29yZAogICAgICAgICAgfTsKICAgICAgICAgIGF3YWl0IHVwZGF0ZVVzZXIodGhpcy5lZGl0SWQsIHBheWxvYWQpOwogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLmm7TmlrDmiJDlip8iKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXdhaXQgY3JlYXRlVXNlcih7CiAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLmZvcm0udXNlcm5hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLmZvcm0uZW1haWwsCiAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLmZvcm0ucGFzc3dvcmQsCiAgICAgICAgICAgIHJvbGU6IHRoaXMuZm9ybS5yb2xlCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5Yib5bu65oiQ5YqfIik7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSBmYWxzZTsKICAgICAgICB0aGlzLmxvYWQoKTsKCiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zdCBtc2cgPSBlPy5yZXNwb25zZT8uZGF0YT8ubWVzc2FnZSB8fCBlPy5tZXNzYWdlIHx8ICLmk43kvZzlpLHotKUiOwogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IobXNnKTsKICAgICAgfQogICAgfSwKCiAgICBhc3luYyByZW1vdmUoaWQpIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoIXRoaXMuaXNBZG1pbikgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5peg5p2D6ZmQIik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBhd2FpdCB0aGlzLiRjb25maXJtKCLnoa7lrprliKDpmaTor6XnlKjmiLfvvJ8iLCAi5o+Q56S6IiwgeyB0eXBlOiAid2FybmluZyIgfSk7CiAgICAgICAgYXdhaXQgZGVsZXRlVXNlcihpZCk7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLliKDpmaTmiJDlip8iKTsKICAgICAgICB0aGlzLmxvYWQoKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmIChlID09PSAiY2FuY2VsIikgcmV0dXJuOwogICAgICAgIGNvbnN0IG1zZyA9IGU/LnJlc3BvbnNlPy5kYXRhPy5tZXNzYWdlIHx8IGU/Lm1lc3NhZ2UgfHwgIuWIoOmZpOWksei0pSI7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihtc2cpOwogICAgICB9CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["list.vue"],"names":[],"mappings":";AAuFA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/modules/user","sourcesContent":["<template>\n  <div>\n    <el-card>\n\n      <div style=\"margin-bottom:16px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;\">\n        <el-button type=\"primary\" @click=\"load\">刷新</el-button>\n\n        <el-button\n            v-if=\"isAdmin\"\n            type=\"success\"\n            @click=\"openCreate\"\n        >\n          新增用户（Admin）\n        </el-button>\n      </div>\n\n      <el-table :data=\"rows\" border v-loading=\"loading\">\n        <el-table-column prop=\"id\" label=\"ID\" width=\"90\" />\n        <el-table-column prop=\"username\" label=\"用户名\" />\n        <el-table-column prop=\"email\" label=\"邮箱\" />\n        <el-table-column label=\"角色\">\n          <template slot-scope=\"scope\">\n            {{ formatRole(scope.row.role) }}\n          </template>\n        </el-table-column>\n\n\n        <el-table-column v-if=\"isAdmin\" label=\"操作\" width=\"220\">\n          <template slot-scope=\"scope\">\n            <el-button size=\"mini\" type=\"primary\" @click=\"openEdit(scope.row.id)\">\n              编辑\n            </el-button>\n            <el-button size=\"mini\" type=\"danger\" @click=\"remove(scope.row.id)\">\n              删除\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <el-pagination\n          style=\"margin-top:16px;\"\n          background\n          layout=\"total, sizes, prev, pager, next\"\n          :total=\"total\"\n          :page-size=\"size\"\n          :page-sizes=\"[10, 20, 50]\"\n          @current-change=\"changePage\"\n          @size-change=\"changeSize\"\n      />\n    </el-card>\n\n    <!-- create/edit dialog -->\n    <el-dialog :title=\"dialogTitle\" :visible.sync=\"dialogVisible\" width=\"700px\">\n      <el-form :model=\"form\" label-width=\"110px\">\n\n        <el-form-item label=\"用户名\" v-if=\"!isEdit\">\n          <el-input v-model=\"form.username\" />\n        </el-form-item>\n\n        <el-form-item label=\"邮箱\">\n          <el-input v-model=\"form.email\" />\n        </el-form-item>\n\n        <el-form-item label=\"密码\">\n          <el-input v-model=\"form.password\" show-password />\n        </el-form-item>\n\n        <el-form-item label=\"角色\">\n          <el-select v-model=\"form.role\" style=\"width: 220px;\">\n            <el-option label=\"STUDENT\" value=\"STUDENT\" />\n            <el-option label=\"TEACHER\" value=\"TEACHER\" />\n            <el-option label=\"ADMIN\" value=\"ADMIN\" />\n          </el-select>\n        </el-form-item>\n\n      </el-form>\n\n      <span slot=\"footer\">\n        <el-button @click=\"dialogVisible=false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"submit\">确定</el-button>\n      </span>\n    </el-dialog>\n\n  </div>\n</template>\n\n<script>\nimport {\n  listUsers,\n  getUserById,\n  createUser,\n  updateUser,\n  deleteUser\n} from \"@/api/user\";\n\nexport default {\n  data() {\n    return {\n      loading: false,\n      rows: [],\n      total: 0,\n      page: 1,\n      size: 10,\n\n      dialogVisible: false,\n      dialogTitle: \"\",\n      isEdit: false,\n      editId: null,\n\n      form: {\n        username: \"\",\n        email: \"\",\n        password: \"\",\n        role: \"STUDENT\"\n      }\n    };\n  },\n\n  computed: {\n    role() {\n      return localStorage.getItem(\"Role\") || \"\";\n    },\n    isAdmin() {\n      return this.role === \"ADMIN\";\n    }\n  },\n\n  mounted() {\n    this.load();\n  },\n\n  methods: {\n    async load() {\n      this.loading = true;\n      try {\n        const res = await listUsers({\n          page: this.page - 1,\n          size: this.size\n        });\n\n        const data = res.data || {};\n        this.rows = data.content || [];\n        this.total = Number(data.totalElements || 0);\n\n      } catch (e) {\n        const msg = e?.response?.data?.message || e?.message || \"加载失败\";\n        this.$message.error(\"用户列表加载失败：\" + msg);\n        this.rows = [];\n        this.total = 0;\n      } finally {\n        this.loading = false;\n      }\n    },\n    formatRole(role) {\n      const map = {\n        ADMIN: \"管理员\",\n        TEACHER: \"教师\",\n        STUDENT: \"学生\"\n      };\n      return map[role] || role;\n    },\n\n\n    changePage(p) {\n      this.page = p;\n      this.load();\n    },\n\n    changeSize(s) {\n      this.size = s;\n      this.page = 1;\n      this.load();\n    },\n\n    openCreate() {\n      this.dialogTitle = \"新增用户（Admin）\";\n      this.isEdit = false;\n      this.editId = null;\n      this.form = {\n        username: \"\",\n        email: \"\",\n        password: \"\",\n        role: \"STUDENT\"\n      };\n      this.dialogVisible = true;\n    },\n\n    async openEdit(id) {\n      this.dialogTitle = \"编辑用户（Admin）\";\n      this.isEdit = true;\n      this.editId = id;\n      this.dialogVisible = true;\n\n      try {\n        const res = await getUserById(id);\n        const u = res.data || {};\n        this.form = {\n          username: u.username || \"\", // 编辑时不改 username，但保留显示用\n          email: u.email || \"\",\n          password: \"\",\n          role: u.role || \"STUDENT\"\n        };\n      } catch (e) {\n        this.$message.error(\"加载用户信息失败\");\n      }\n    },\n\n    async submit() {\n      try {\n        if (!this.isAdmin) {\n          this.$message.error(\"无权限\");\n          return;\n        }\n\n        if (this.isEdit) {\n          // 按你后端：put body 可包含 email/role/password\n          const payload = {\n            email: this.form.email,\n            role: this.form.role,\n            password: this.form.password\n          };\n          await updateUser(this.editId, payload);\n          this.$message.success(\"更新成功\");\n        } else {\n          await createUser({\n            username: this.form.username,\n            email: this.form.email,\n            password: this.form.password,\n            role: this.form.role\n          });\n          this.$message.success(\"创建成功\");\n        }\n\n        this.dialogVisible = false;\n        this.load();\n\n      } catch (e) {\n        const msg = e?.response?.data?.message || e?.message || \"操作失败\";\n        this.$message.error(msg);\n      }\n    },\n\n    async remove(id) {\n      try {\n        if (!this.isAdmin) {\n          this.$message.error(\"无权限\");\n          return;\n        }\n\n        await this.$confirm(\"确定删除该用户？\", \"提示\", { type: \"warning\" });\n        await deleteUser(id);\n        this.$message.success(\"删除成功\");\n        this.load();\n      } catch (e) {\n        if (e === \"cancel\") return;\n        const msg = e?.response?.data?.message || e?.message || \"删除失败\";\n        this.$message.error(msg);\n      }\n    }\n  }\n};\n</script>\n"]}]}