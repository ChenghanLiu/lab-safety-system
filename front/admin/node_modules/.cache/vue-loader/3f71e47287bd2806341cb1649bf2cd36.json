{"remainingRequest":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liuchenghan/Desktop/lab-safety-system/front/admin/src/views/modules/inspection/list.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/src/views/modules/inspection/list.vue","mtime":1771434353099},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/cache-loader/dist/cjs.js","mtime":1771254462036},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/babel-loader/lib/index.js","mtime":1771254462371},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/cache-loader/dist/cjs.js","mtime":1771254462036},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/vue-loader/lib/index.js","mtime":1771254462450}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7CiAgbGlzdEluc3BlY3Rpb25QbGFuc0J5TGFiLAogIGNyZWF0ZUluc3BlY3Rpb25QbGFuLAogIHJlY29yZEluc3BlY3Rpb24sCiAgZ2V0SW5zcGVjdGlvblJlY29yZAp9IGZyb20gIkAvYXBpL2luc3BlY3Rpb24iOwoKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgbGlzdDogW10sCiAgICAgIHRvdGFsOiAwLAogICAgICBwYWdlOiAxLAogICAgICBzaXplOiAxMCwKCiAgICAgIGZpbHRlcnM6IHsKICAgICAgICBsYWJJZDogIjQiIC8vIOS9oOm7mOiupOW4uOeUqCA077yM5oOz56m65bCx5Yig5o6JCiAgICAgIH0sCgogICAgICBjcmVhdGVWaXNpYmxlOiBmYWxzZSwKICAgICAgY3JlYXRlRm9ybTogewogICAgICAgIGxhYklkOiAiIiwKICAgICAgICBpbnNwZWN0b3JJZDogIiIsCiAgICAgICAgaW5zcGVjdGlvblRpbWU6ICIiLAogICAgICAgIGNvbnRlbnQ6ICIiCiAgICAgIH0sCgogICAgICByZWNvcmRWaXNpYmxlOiBmYWxzZSwKICAgICAgcmVjb3JkRm9ybTogewogICAgICAgIHBsYW5JZDogbnVsbCwKICAgICAgICBpc1NhZmU6IGZhbHNlLAogICAgICAgIHByb2JsZW1EZXNjcmlwdGlvbjogIiIsCiAgICAgICAgc3VnZ2VzdGlvbjogIiIKICAgICAgfSwKCiAgICAgIHZpZXdWaXNpYmxlOiBmYWxzZSwKICAgICAgdmlld0xvYWRpbmc6IGZhbHNlLAogICAgICB2aWV3UmVjb3JkOiB7fQogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgcm9sZSgpIHsKICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJSb2xlIikgfHwgIiI7CiAgICB9LAogICAgaXNBZG1pbigpIHsKICAgICAgcmV0dXJuIHRoaXMucm9sZSA9PT0gIkFETUlOIjsKICAgIH0sCiAgICAvLyDov5nph4zlhYjnroDljZXvvJpURUFDSEVSIOS5n+WFgeiuuOW9leWFpe+8iOWmguaenOS9oOWQjuerr+WPquWFgeiuuCBpbnNwZWN0b3LvvIzmnKzmjInpkq7kuI3kvJrlvbHlk43lronlhajmgKfvvIkKICAgIGlzVGVhY2hlcigpIHsKICAgICAgcmV0dXJuIHRoaXMucm9sZSA9PT0gIlRFQUNIRVIiOwogICAgfSwKICAgIGNhblJlY29yZEFueSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNBZG1pbiB8fCB0aGlzLmlzVGVhY2hlcjsKICAgIH0KICB9LAoKICBtb3VudGVkKCkgewogICAgaWYgKHRoaXMuZmlsdGVycy5sYWJJZCkgdGhpcy5sb2FkKCk7CiAgfSwKCiAgbWV0aG9kczogewogICAgYXN5bmMgbG9hZCgpIHsKICAgICAgY29uc3QgbGFiSWQgPSBTdHJpbmcodGhpcy5maWx0ZXJzLmxhYklkIHx8ICIiKS50cmltKCk7CiAgICAgIGlmICghbGFiSWQpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoIuivt+WFiOi+k+WFpeWunumqjOWupElEIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGxpc3RJbnNwZWN0aW9uUGxhbnNCeUxhYihsYWJJZCwgewogICAgICAgICAgcGFnZTogdGhpcy5wYWdlIC0gMSwKICAgICAgICAgIHNpemU6IHRoaXMuc2l6ZQogICAgICAgIH0pOwoKICAgICAgICBjb25zdCBkYXRhID0gcmVzLmRhdGEgfHwge307CiAgICAgICAgdGhpcy5saXN0ID0gZGF0YS5jb250ZW50IHx8IFtdOwogICAgICAgIHRoaXMudG90YWwgPSBOdW1iZXIoZGF0YS50b3RhbEVsZW1lbnRzIHx8IDApOwoKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnN0IHN0YXR1cyA9IGU/LnJlc3BvbnNlPy5zdGF0dXM7CiAgICAgICAgY29uc3QgbXNnID0gZT8ucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2UgfHwgZT8ubWVzc2FnZSB8fCAi5Yqg6L295aSx6LSlIjsKICAgICAgICBjb25zb2xlLmVycm9yKCJbaW5zcGVjdGlvbl0gbGlzdCBFUlJPUiIsIHN0YXR1cywgZT8ucmVzcG9uc2U/LmRhdGEgfHwgZSk7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5Yqg6L295qOA5p+l6K6h5YiS5aSx6LSl77yaIiArIG1zZyk7CiAgICAgICAgdGhpcy5saXN0ID0gW107CiAgICAgICAgdGhpcy50b3RhbCA9IDA7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgc2VhcmNoKCkgewogICAgICB0aGlzLnBhZ2UgPSAxOwogICAgICB0aGlzLmxvYWQoKTsKICAgIH0sCgogICAgY2hhbmdlUGFnZShwKSB7CiAgICAgIHRoaXMucGFnZSA9IHA7CiAgICAgIHRoaXMubG9hZCgpOwogICAgfSwKCiAgICBjaGFuZ2VTaXplKHMpIHsKICAgICAgdGhpcy5zaXplID0gczsKICAgICAgdGhpcy5wYWdlID0gMTsKICAgICAgdGhpcy5sb2FkKCk7CiAgICB9LAoKICAgIG9wZW5DcmVhdGVQbGFuKCkgewogICAgICB0aGlzLmNyZWF0ZUZvcm0gPSB7CiAgICAgICAgbGFiSWQ6IFN0cmluZyh0aGlzLmZpbHRlcnMubGFiSWQgfHwgIiIpLnRyaW0oKSwKICAgICAgICBpbnNwZWN0b3JJZDogIiIsCiAgICAgICAgaW5zcGVjdGlvblRpbWU6ICIiLAogICAgICAgIGNvbnRlbnQ6ICIiCiAgICAgIH07CiAgICAgIHRoaXMuY3JlYXRlVmlzaWJsZSA9IHRydWU7CiAgICB9LAoKICAgIGFzeW5jIHN1Ym1pdENyZWF0ZVBsYW4oKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcGFyYW1zID0gewogICAgICAgICAgbGFiSWQ6IHRoaXMuY3JlYXRlRm9ybS5sYWJJZCwKICAgICAgICAgIGluc3BlY3RvcklkOiB0aGlzLmNyZWF0ZUZvcm0uaW5zcGVjdG9ySWQsCiAgICAgICAgICBpbnNwZWN0aW9uVGltZTogdGhpcy5jcmVhdGVGb3JtLmluc3BlY3Rpb25UaW1lLAogICAgICAgICAgY29udGVudDogdGhpcy5jcmVhdGVGb3JtLmNvbnRlbnQKICAgICAgICB9OwoKICAgICAgICBhd2FpdCBjcmVhdGVJbnNwZWN0aW9uUGxhbihwYXJhbXMpOwogICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5Yib5bu65oiQ5YqfIik7CiAgICAgICAgdGhpcy5jcmVhdGVWaXNpYmxlID0gZmFsc2U7CiAgICAgICAgdGhpcy5sb2FkKCk7CgogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc3Qgc3RhdHVzID0gZT8ucmVzcG9uc2U/LnN0YXR1czsKICAgICAgICBjb25zdCBtc2cgPSBlPy5yZXNwb25zZT8uZGF0YT8ubWVzc2FnZSB8fCBlPy5tZXNzYWdlIHx8ICLliJvlu7rlpLHotKUiOwogICAgICAgIGNvbnNvbGUuZXJyb3IoIltpbnNwZWN0aW9uXSBjcmVhdGUgRVJST1IiLCBzdGF0dXMsIGU/LnJlc3BvbnNlPy5kYXRhIHx8IGUpOwogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IobXNnKTsKICAgICAgfQogICAgfSwKCiAgICAvLyDinIUg5piv5ZCm5pi+56S64oCc5b2V5YWl57uT5p6c4oCd5oyJ6ZKu77yaCiAgICAvLyAtIEFkbWluIOaAu+iDveeci+WIsAogICAgLy8gLSBUZWFjaGVyIOS5n+iDveeci+WIsO+8iOWmguaenOS9oOaDs+S4peagvCBpbnNwZWN0b3JJZCA9PSDlvZPliY3nlKjmiLdJRO+8jOmcgOimgeS9oOWQjuerr+i/lOWbniB1c2VybmFtZSDmiJbliY3nq6/lrZggdXNlcklk77yJCiAgICAvLyAtIOWPquaciSBTQ0hFRFVMRUQg5omN57uZ5b2V5YWl77yI6YG/5YWN6YeN5aSN5b2V77yJCiAgICBjYW5SZWNvcmQocm93KSB7CiAgICAgIGlmICghcm93KSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghKHRoaXMuaXNBZG1pbiB8fCB0aGlzLmlzVGVhY2hlcikpIHJldHVybiBmYWxzZTsKICAgICAgcmV0dXJuIHJvdy5zdGF0dXMgPT09ICJTQ0hFRFVMRUQiOwogICAgfSwKCiAgICBvcGVuUmVjb3JkKHJvdykgewogICAgICB0aGlzLnJlY29yZEZvcm0gPSB7CiAgICAgICAgcGxhbklkOiByb3cuaWQsCiAgICAgICAgaXNTYWZlOiBmYWxzZSwKICAgICAgICBwcm9ibGVtRGVzY3JpcHRpb246ICIiLAogICAgICAgIHN1Z2dlc3Rpb246ICIiCiAgICAgIH07CiAgICAgIHRoaXMucmVjb3JkVmlzaWJsZSA9IHRydWU7CiAgICB9LAoKICAgIGFzeW5jIHN1Ym1pdFJlY29yZCgpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgICBpc1NhZmU6IHRoaXMucmVjb3JkRm9ybS5pc1NhZmUsCiAgICAgICAgICBwcm9ibGVtRGVzY3JpcHRpb246IHRoaXMucmVjb3JkRm9ybS5wcm9ibGVtRGVzY3JpcHRpb24sCiAgICAgICAgICBzdWdnZXN0aW9uOiB0aGlzLnJlY29yZEZvcm0uc3VnZ2VzdGlvbgogICAgICAgIH07CgogICAgICAgIGF3YWl0IHJlY29yZEluc3BlY3Rpb24odGhpcy5yZWNvcmRGb3JtLnBsYW5JZCwgcGFyYW1zKTsKICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuaPkOS6pOaIkOWKnyIpOwogICAgICAgIHRoaXMucmVjb3JkVmlzaWJsZSA9IGZhbHNlOwogICAgICAgIHRoaXMubG9hZCgpOwoKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnN0IHN0YXR1cyA9IGU/LnJlc3BvbnNlPy5zdGF0dXM7CiAgICAgICAgY29uc3QgbXNnID0gZT8ucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2UgfHwgZT8ubWVzc2FnZSB8fCAi5o+Q5Lqk5aSx6LSlIjsKICAgICAgICBjb25zb2xlLmVycm9yKCJbaW5zcGVjdGlvbl0gcmVjb3JkIEVSUk9SIiwgc3RhdHVzLCBlPy5yZXNwb25zZT8uZGF0YSB8fCBlKTsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKG1zZyk7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgb3BlblZpZXdSZWNvcmQocGxhbklkKSB7CiAgICAgIHRoaXMudmlld1Zpc2libGUgPSB0cnVlOwogICAgICB0aGlzLnZpZXdMb2FkaW5nID0gdHJ1ZTsKICAgICAgdGhpcy52aWV3UmVjb3JkID0ge307CgogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGdldEluc3BlY3Rpb25SZWNvcmQocGxhbklkKTsKICAgICAgICB0aGlzLnZpZXdSZWNvcmQgPSByZXMuZGF0YSB8fCB7fTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnN0IHN0YXR1cyA9IGU/LnJlc3BvbnNlPy5zdGF0dXM7CiAgICAgICAgLy8g6K6w5b2V5Y+v6IO95LiN5a2Y5Zyo77yI5q+U5aaC6L+Y5rKh5b2V5YWl77yJ77yM5ZCO56uv5Y+v6IO96L+U5ZueIDQwNC81MDAKICAgICAgICBjb25zdCBtc2cgPSBlPy5yZXNwb25zZT8uZGF0YT8ubWVzc2FnZSB8fCBlPy5tZXNzYWdlIHx8ICLmmoLml6DorrDlvZUiOwogICAgICAgIGNvbnNvbGUuZXJyb3IoIltpbnNwZWN0aW9uXSBnZXRSZWNvcmQgRVJST1IiLCBzdGF0dXMsIGU/LnJlc3BvbnNlPy5kYXRhIHx8IGUpOwogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IobXNnKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzLnZpZXdMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["list.vue"],"names":[],"mappings":";AAiJA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/modules/inspection","sourcesContent":["<template>\n  <div>\n    <el-card>\n\n      <!-- 顶部筛选/操作 -->\n      <div style=\"margin-bottom:16px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;\">\n        <el-input\n            v-model=\"filters.labId\"\n            placeholder=\"实验室ID（必填）\"\n            style=\"width: 200px;\"\n            clearable\n        />\n        <el-button type=\"primary\" @click=\"search\">加载</el-button>\n\n        <el-button\n            v-if=\"isAdmin\"\n            type=\"success\"\n            @click=\"openCreatePlan\"\n        >\n          新建检查计划（Admin）\n        </el-button>\n      </div>\n\n      <!-- 表格 -->\n      <el-table :data=\"list\" border v-loading=\"loading\">\n        <el-table-column prop=\"id\" label=\"计划ID\" width=\"90\" />\n        <el-table-column prop=\"labId\" label=\"实验室ID\" width=\"100\" />\n        <el-table-column prop=\"inspectorId\" label=\"检查员ID\" width=\"110\" />\n        <el-table-column prop=\"inspectionTime\" label=\"检查时间\" width=\"180\" />\n        <el-table-column prop=\"content\" label=\"检查内容\" />\n        <el-table-column prop=\"status\" label=\"状态\" width=\"120\" />\n        <el-table-column prop=\"createdAt\" label=\"创建时间\" width=\"180\" />\n\n        <el-table-column label=\"操作\" width=\"260\">\n          <template slot-scope=\"scope\">\n            <el-button size=\"mini\" @click=\"openViewRecord(scope.row.id)\">\n              查看记录\n            </el-button>\n\n            <el-button\n                v-if=\"canRecord(scope.row)\"\n                size=\"mini\"\n                type=\"primary\"\n                @click=\"openRecord(scope.row)\"\n            >\n              录入结果\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <!-- 分页 -->\n      <el-pagination\n          style=\"margin-top:16px;\"\n          background\n          layout=\"total, sizes, prev, pager, next\"\n          :total=\"total\"\n          :page-size=\"size\"\n          :page-sizes=\"[10, 20, 50]\"\n          @current-change=\"changePage\"\n          @size-change=\"changeSize\"\n      />\n    </el-card>\n\n    <!-- 新建检查计划 -->\n    <el-dialog title=\"新建检查计划（Admin）\" :visible.sync=\"createVisible\" width=\"700px\">\n      <el-form :model=\"createForm\" label-width=\"110px\">\n        <el-form-item label=\"实验室ID\">\n          <el-input v-model=\"createForm.labId\" />\n        </el-form-item>\n\n        <el-form-item label=\"检查员ID\">\n          <el-input v-model=\"createForm.inspectorId\" />\n        </el-form-item>\n\n        <el-form-item label=\"检查时间\">\n          <el-date-picker\n              v-model=\"createForm.inspectionTime\"\n              type=\"datetime\"\n              value-format=\"yyyy-MM-ddTHH:mm:ss\"\n          />\n        </el-form-item>\n\n        <el-form-item label=\"检查内容\">\n          <el-input v-model=\"createForm.content\" />\n        </el-form-item>\n      </el-form>\n\n      <span slot=\"footer\">\n        <el-button @click=\"createVisible=false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"submitCreatePlan\">提交</el-button>\n      </span>\n    </el-dialog>\n\n    <!-- 录入检查结果 -->\n    <el-dialog title=\"录入检查结果\" :visible.sync=\"recordVisible\" width=\"700px\">\n      <el-form :model=\"recordForm\" label-width=\"110px\">\n\n        <el-form-item label=\"计划ID\">\n          <el-input v-model=\"recordForm.planId\" disabled />\n        </el-form-item>\n\n        <el-form-item label=\"是否安全\">\n          <el-select v-model=\"recordForm.isSafe\" placeholder=\"请选择\" style=\"width: 200px;\">\n            <el-option :value=\"true\" label=\"安全（true）\" />\n            <el-option :value=\"false\" label=\"不安全（false）\" />\n          </el-select>\n        </el-form-item>\n\n        <el-form-item label=\"问题描述\">\n          <el-input v-model=\"recordForm.problemDescription\" type=\"textarea\" :rows=\"2\" />\n        </el-form-item>\n\n        <el-form-item label=\"建议\">\n          <el-input v-model=\"recordForm.suggestion\" type=\"textarea\" :rows=\"2\" />\n        </el-form-item>\n\n      </el-form>\n\n      <span slot=\"footer\">\n        <el-button @click=\"recordVisible=false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"submitRecord\">提交</el-button>\n      </span>\n    </el-dialog>\n\n    <!-- 查看记录 -->\n    <el-dialog title=\"检查记录\" :visible.sync=\"viewVisible\" width=\"700px\">\n      <el-descriptions :column=\"1\" border v-loading=\"viewLoading\">\n        <el-descriptions-item label=\"记录ID\">{{ viewRecord.id }}</el-descriptions-item>\n        <el-descriptions-item label=\"计划ID\">{{ viewRecord.planId }}</el-descriptions-item>\n        <el-descriptions-item label=\"是否安全\">{{ viewRecord.isSafe }}</el-descriptions-item>\n        <el-descriptions-item label=\"问题描述\">{{ viewRecord.problemDescription }}</el-descriptions-item>\n        <el-descriptions-item label=\"建议\">{{ viewRecord.suggestion }}</el-descriptions-item>\n        <el-descriptions-item label=\"创建时间\">{{ viewRecord.createdAt }}</el-descriptions-item>\n      </el-descriptions>\n\n      <span slot=\"footer\">\n        <el-button @click=\"viewVisible=false\">关闭</el-button>\n      </span>\n    </el-dialog>\n\n  </div>\n</template>\n\n<script>\nimport {\n  listInspectionPlansByLab,\n  createInspectionPlan,\n  recordInspection,\n  getInspectionRecord\n} from \"@/api/inspection\";\n\nexport default {\n  data() {\n    return {\n      loading: false,\n      list: [],\n      total: 0,\n      page: 1,\n      size: 10,\n\n      filters: {\n        labId: \"4\" // 你默认常用 4，想空就删掉\n      },\n\n      createVisible: false,\n      createForm: {\n        labId: \"\",\n        inspectorId: \"\",\n        inspectionTime: \"\",\n        content: \"\"\n      },\n\n      recordVisible: false,\n      recordForm: {\n        planId: null,\n        isSafe: false,\n        problemDescription: \"\",\n        suggestion: \"\"\n      },\n\n      viewVisible: false,\n      viewLoading: false,\n      viewRecord: {}\n    };\n  },\n\n  computed: {\n    role() {\n      return localStorage.getItem(\"Role\") || \"\";\n    },\n    isAdmin() {\n      return this.role === \"ADMIN\";\n    },\n    // 这里先简单：TEACHER 也允许录入（如果你后端只允许 inspector，本按钮不会影响安全性）\n    isTeacher() {\n      return this.role === \"TEACHER\";\n    },\n    canRecordAny() {\n      return this.isAdmin || this.isTeacher;\n    }\n  },\n\n  mounted() {\n    if (this.filters.labId) this.load();\n  },\n\n  methods: {\n    async load() {\n      const labId = String(this.filters.labId || \"\").trim();\n      if (!labId) {\n        this.$message.warning(\"请先输入实验室ID\");\n        return;\n      }\n\n      this.loading = true;\n      try {\n        const res = await listInspectionPlansByLab(labId, {\n          page: this.page - 1,\n          size: this.size\n        });\n\n        const data = res.data || {};\n        this.list = data.content || [];\n        this.total = Number(data.totalElements || 0);\n\n      } catch (e) {\n        const status = e?.response?.status;\n        const msg = e?.response?.data?.message || e?.message || \"加载失败\";\n        console.error(\"[inspection] list ERROR\", status, e?.response?.data || e);\n        this.$message.error(\"加载检查计划失败：\" + msg);\n        this.list = [];\n        this.total = 0;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    search() {\n      this.page = 1;\n      this.load();\n    },\n\n    changePage(p) {\n      this.page = p;\n      this.load();\n    },\n\n    changeSize(s) {\n      this.size = s;\n      this.page = 1;\n      this.load();\n    },\n\n    openCreatePlan() {\n      this.createForm = {\n        labId: String(this.filters.labId || \"\").trim(),\n        inspectorId: \"\",\n        inspectionTime: \"\",\n        content: \"\"\n      };\n      this.createVisible = true;\n    },\n\n    async submitCreatePlan() {\n      try {\n        const params = {\n          labId: this.createForm.labId,\n          inspectorId: this.createForm.inspectorId,\n          inspectionTime: this.createForm.inspectionTime,\n          content: this.createForm.content\n        };\n\n        await createInspectionPlan(params);\n        this.$message.success(\"创建成功\");\n        this.createVisible = false;\n        this.load();\n\n      } catch (e) {\n        const status = e?.response?.status;\n        const msg = e?.response?.data?.message || e?.message || \"创建失败\";\n        console.error(\"[inspection] create ERROR\", status, e?.response?.data || e);\n        this.$message.error(msg);\n      }\n    },\n\n    // ✅ 是否显示“录入结果”按钮：\n    // - Admin 总能看到\n    // - Teacher 也能看到（如果你想严格 inspectorId == 当前用户ID，需要你后端返回 username 或前端存 userId）\n    // - 只有 SCHEDULED 才给录入（避免重复录）\n    canRecord(row) {\n      if (!row) return false;\n      if (!(this.isAdmin || this.isTeacher)) return false;\n      return row.status === \"SCHEDULED\";\n    },\n\n    openRecord(row) {\n      this.recordForm = {\n        planId: row.id,\n        isSafe: false,\n        problemDescription: \"\",\n        suggestion: \"\"\n      };\n      this.recordVisible = true;\n    },\n\n    async submitRecord() {\n      try {\n        const params = {\n          isSafe: this.recordForm.isSafe,\n          problemDescription: this.recordForm.problemDescription,\n          suggestion: this.recordForm.suggestion\n        };\n\n        await recordInspection(this.recordForm.planId, params);\n        this.$message.success(\"提交成功\");\n        this.recordVisible = false;\n        this.load();\n\n      } catch (e) {\n        const status = e?.response?.status;\n        const msg = e?.response?.data?.message || e?.message || \"提交失败\";\n        console.error(\"[inspection] record ERROR\", status, e?.response?.data || e);\n        this.$message.error(msg);\n      }\n    },\n\n    async openViewRecord(planId) {\n      this.viewVisible = true;\n      this.viewLoading = true;\n      this.viewRecord = {};\n\n      try {\n        const res = await getInspectionRecord(planId);\n        this.viewRecord = res.data || {};\n      } catch (e) {\n        const status = e?.response?.status;\n        // 记录可能不存在（比如还没录入），后端可能返回 404/500\n        const msg = e?.response?.data?.message || e?.message || \"暂无记录\";\n        console.error(\"[inspection] getRecord ERROR\", status, e?.response?.data || e);\n        this.$message.error(msg);\n      } finally {\n        this.viewLoading = false;\n      }\n    }\n  }\n};\n</script>\n"]}]}