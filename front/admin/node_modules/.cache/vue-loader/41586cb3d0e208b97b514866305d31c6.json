{"remainingRequest":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liuchenghan/Desktop/lab-safety-system/front/admin/src/views/modules/training/list.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/src/views/modules/training/list.vue","mtime":1771493916133},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/cache-loader/dist/cjs.js","mtime":1771254462036},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/babel-loader/lib/index.js","mtime":1771254462371},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/cache-loader/dist/cjs.js","mtime":1771254462036},{"path":"/Users/liuchenghan/Desktop/lab-safety-system/front/admin/node_modules/vue-loader/lib/index.js","mtime":1771254462450}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7CiAgbGlzdFRyYWluaW5nQ291cnNlcywKICBnZXRUcmFpbmluZ0NvdXJzZSwKICBjcmVhdGVUcmFpbmluZ0NvdXJzZSwKICBlbnJvbGxDb3Vyc2UsCiAgZ2V0VHJhaW5pbmdRdWVzdGlvbnMsCiAgc3RhcnRBdHRlbXB0LAogIHN1Ym1pdEF0dGVtcHQsCiAgZ2V0QXR0ZW1wdEhpc3RvcnkKfSBmcm9tICJAL2FwaS90cmFpbmluZyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICByb3dzOiBbXSwKICAgICAgdG90YWw6IDAsCiAgICAgIHBhZ2U6IDEsCiAgICAgIHNpemU6IDEwLAoKICAgICAgZGV0YWlsVmlzaWJsZTogZmFsc2UsCiAgICAgIGRldGFpbExvYWRpbmc6IGZhbHNlLAogICAgICBkZXRhaWw6IG51bGwsCgogICAgICBxdWl6VmlzaWJsZTogZmFsc2UsCiAgICAgIHF1aXpMb2FkaW5nOiBmYWxzZSwKICAgICAgcXVpekNvdXJzZUlkOiBudWxsLAogICAgICBxdWl6QXR0ZW1wdElkOiBudWxsLAogICAgICBxdWl6UXVlc3Rpb25zOiBbXSwKICAgICAgcXVpekFuc3dlcnM6IHt9LAoKICAgICAgaGlzdG9yeVZpc2libGU6IGZhbHNlLAogICAgICBoaXN0b3J5TG9hZGluZzogZmFsc2UsCiAgICAgIGhpc3RvcnlMaXN0OiBbXSwKCiAgICAgIGNyZWF0ZVZpc2libGU6IGZhbHNlLAogICAgICBjcmVhdGVGb3JtOiB7CiAgICAgICAgdGl0bGU6ICIiLAogICAgICAgIGNvbnRlbnQ6ICIiLAogICAgICAgIHN0YXJ0VGltZTogIiIsCiAgICAgICAgZW5kVGltZTogIiIsCiAgICAgICAgbW9kZTogIk9OTElORSIsCiAgICAgICAgcGFzc2luZ1Njb3JlOiA2MCwKICAgICAgICBkdXJhdGlvbk1pbnV0ZXM6IDMwCiAgICAgIH0KICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIHJvbGUoKSB7CiAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiUm9sZSIpIHx8ICIiOwogICAgfSwKICAgIGlzQWRtaW4oKSB7CiAgICAgIHJldHVybiB0aGlzLnJvbGUgPT09ICJBRE1JTiI7CiAgICB9LAogICAgaXNTdHVkZW50KCkgewogICAgICByZXR1cm4gdGhpcy5yb2xlID09PSAiU1RVREVOVCI7CiAgICB9CiAgfSwKCiAgbW91bnRlZCgpIHsKICAgIHRoaXMubG9hZCgpOwogIH0sCgogIG1ldGhvZHM6IHsKICAgIGRhc2godikgewogICAgICAvLyBrZWVwIFVJIHVuY2hhbmdlZDsganVzdCBhdm9pZCBlbXB0eSBjZWxscwogICAgICBpZiAodiA9PT0gbnVsbCB8fCB2ID09PSB1bmRlZmluZWQpIHJldHVybiAiLSI7CiAgICAgIGNvbnN0IHMgPSBTdHJpbmcodik7CiAgICAgIHJldHVybiBzLnRyaW0oKSA9PT0gIiIgPyAiLSIgOiB2OwogICAgfSwKCiAgICBub3JtYWxpemVDb3Vyc2UocmF3KSB7CiAgICAgIGNvbnN0IGMgPSByYXcgfHwge307CiAgICAgIC8vIOWFvOWuue+8muWQjuerr+WPr+iDveWPqui/lOWbniBpZC90aXRsZe+8jOaIluWtl+auteWQjeS4jeWQjAogICAgICByZXR1cm4gewogICAgICAgIGlkOiB0aGlzLmRhc2goYy5pZCksCiAgICAgICAgdGl0bGU6IHRoaXMuZGFzaChjLnRpdGxlIHx8IGMubmFtZSksCgogICAgICAgIG1vZGU6IHRoaXMuZGFzaChjLm1vZGUpLAogICAgICAgIHBhc3NpbmdTY29yZTogdGhpcy5kYXNoKGMucGFzc2luZ1Njb3JlKSwKCiAgICAgICAgc3RhcnRUaW1lOiB0aGlzLmRhc2goYy5zdGFydFRpbWUpLAogICAgICAgIGVuZFRpbWU6IHRoaXMuZGFzaChjLmVuZFRpbWUpLAoKICAgICAgICBkdXJhdGlvbk1pbnV0ZXM6IHRoaXMuZGFzaChjLmR1cmF0aW9uTWludXRlcyksCgogICAgICAgIGNyZWF0ZWRBdDogdGhpcy5kYXNoKGMuY3JlYXRlZEF0KSwKCiAgICAgICAgY29udGVudDogdGhpcy5kYXNoKGMuY29udGVudCB8fCBjLmRlc2NyaXB0aW9uIHx8IGMuZGV0YWlscykKICAgICAgfTsKICAgIH0sCgogICAgYXN5bmMgbG9hZCgpIHsKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBsaXN0VHJhaW5pbmdDb3Vyc2VzKHsgcGFnZTogdGhpcy5wYWdlIC0gMSwgc2l6ZTogdGhpcy5zaXplIH0pOwogICAgICAgIGNvbnN0IGRhdGEgPSByZXMuZGF0YSB8fCB7fTsKICAgICAgICB0aGlzLnJvd3MgPSBkYXRhLmNvbnRlbnQgfHwgW107CiAgICAgICAgdGhpcy50b3RhbCA9IE51bWJlcihkYXRhLnRvdGFsRWxlbWVudHMgfHwgMCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zdCBtc2cgPSBlPy5yZXNwb25zZT8uZGF0YT8ubWVzc2FnZSB8fCBlPy5tZXNzYWdlIHx8ICLliqDovb3lpLHotKUiOwogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuivvueoi+WKoOi9veWksei0pe+8miIgKyBtc2cpOwogICAgICAgIHRoaXMucm93cyA9IFtdOwogICAgICAgIHRoaXMudG90YWwgPSAwOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIGNoYW5nZVBhZ2UocCkgewogICAgICB0aGlzLnBhZ2UgPSBwOwogICAgICB0aGlzLmxvYWQoKTsKICAgIH0sCgogICAgY2hhbmdlU2l6ZShzKSB7CiAgICAgIHRoaXMuc2l6ZSA9IHM7CiAgICAgIHRoaXMucGFnZSA9IDE7CiAgICAgIHRoaXMubG9hZCgpOwogICAgfSwKCiAgICBhc3luYyBvcGVuQ291cnNlRGV0YWlsKGNvdXJzZUlkKSB7CiAgICAgIHRoaXMuZGV0YWlsVmlzaWJsZSA9IHRydWU7CiAgICAgIHRoaXMuZGV0YWlsTG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMuZGV0YWlsID0gbnVsbDsKCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0VHJhaW5pbmdDb3Vyc2UoY291cnNlSWQpOwogICAgICAgIHRoaXMuZGV0YWlsID0gdGhpcy5ub3JtYWxpemVDb3Vyc2UocmVzLmRhdGEpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc3QgbXNnID0gZT8ucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2UgfHwgZT8ubWVzc2FnZSB8fCAi6I635Y+W5aSx6LSlIjsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKG1zZyk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdGhpcy5kZXRhaWxMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgZW5yb2xsKGNvdXJzZUlkKSB7CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgZW5yb2xsQ291cnNlKGNvdXJzZUlkKTsKICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuaKpeWQjeaIkOWKnyIpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc3QgbXNnID0gZT8ucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2UgfHwgZT8ubWVzc2FnZSB8fCAi5oql5ZCN5aSx6LSlIjsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKG1zZyk7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgb3BlblF1aXooY291cnNlSWQpIHsKICAgICAgdGhpcy5xdWl6VmlzaWJsZSA9IHRydWU7CiAgICAgIHRoaXMucXVpekxvYWRpbmcgPSB0cnVlOwoKICAgICAgdGhpcy5xdWl6Q291cnNlSWQgPSBjb3Vyc2VJZDsKICAgICAgdGhpcy5xdWl6QXR0ZW1wdElkID0gbnVsbDsKICAgICAgdGhpcy5xdWl6UXVlc3Rpb25zID0gW107CiAgICAgIHRoaXMucXVpekFuc3dlcnMgPSB7fTsKCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcVJlcyA9IGF3YWl0IGdldFRyYWluaW5nUXVlc3Rpb25zKGNvdXJzZUlkKTsKICAgICAgICBjb25zdCBsaXN0ID0gQXJyYXkuaXNBcnJheShxUmVzLmRhdGEpID8gcVJlcy5kYXRhIDogKHFSZXMuZGF0YT8uY29udGVudCB8fCBbXSk7CiAgICAgICAgdGhpcy5xdWl6UXVlc3Rpb25zID0gKGxpc3QgfHwgW10pLmZpbHRlcih4ID0+IHggJiYgeC5xdWVzdGlvbklkICE9IG51bGwpOwoKICAgICAgICBjb25zdCBhbnMgPSB7fTsKICAgICAgICB0aGlzLnF1aXpRdWVzdGlvbnMuZm9yRWFjaChxID0+IHsgYW5zW3EucXVlc3Rpb25JZF0gPSAiIjsgfSk7CiAgICAgICAgdGhpcy5xdWl6QW5zd2VycyA9IGFuczsKCiAgICAgICAgY29uc3QgYVJlcyA9IGF3YWl0IHN0YXJ0QXR0ZW1wdChjb3Vyc2VJZCk7CiAgICAgICAgdGhpcy5xdWl6QXR0ZW1wdElkID0gYVJlcy5kYXRhPy5pZDsKCiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zdCBtc2cgPSBlPy5yZXNwb25zZT8uZGF0YT8ubWVzc2FnZSB8fCBlPy5tZXNzYWdlIHx8ICLmiZPlvIDlpLHotKUiOwogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuaJk+W8gOiAg+ivleWksei0pe+8miIgKyBtc2cpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMucXVpekxvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBjbG9zZVF1aXooKSB7CiAgICAgIHRoaXMucXVpelZpc2libGUgPSBmYWxzZTsKICAgICAgdGhpcy5xdWl6Q291cnNlSWQgPSBudWxsOwogICAgICB0aGlzLnF1aXpBdHRlbXB0SWQgPSBudWxsOwogICAgICB0aGlzLnF1aXpRdWVzdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWl6QW5zd2VycyA9IHt9OwogICAgfSwKCiAgICBhc3luYyBzdWJtaXRRdWl6KCkgewogICAgICBpZiAoIXRoaXMucXVpekF0dGVtcHRJZCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoImF0dGVtcHRJZCDkuLrnqboiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHBheWxvYWQgPSB7fTsKICAgICAgdGhpcy5xdWl6UXVlc3Rpb25zLmZvckVhY2gocSA9PiB7CiAgICAgICAgY29uc3QgdiA9IHRoaXMucXVpekFuc3dlcnNbcS5xdWVzdGlvbklkXTsKICAgICAgICBpZiAodikgcGF5bG9hZFtTdHJpbmcocS5xdWVzdGlvbklkKV0gPSBTdHJpbmcodikudHJpbSgpLnRvVXBwZXJDYXNlKCk7CiAgICAgIH0pOwoKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCBzdWJtaXRBdHRlbXB0KHRoaXMucXVpekF0dGVtcHRJZCwgcGF5bG9hZCk7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLmj5DkuqTmiJDlip8iKTsKICAgICAgICB0aGlzLmNsb3NlUXVpeigpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc3QgbXNnID0gZT8ucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2UgfHwgZT8ubWVzc2FnZSB8fCAi5o+Q5Lqk5aSx6LSlIjsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKG1zZyk7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgb3Blbkhpc3RvcnkoY291cnNlSWQpIHsKICAgICAgdGhpcy5oaXN0b3J5VmlzaWJsZSA9IHRydWU7CiAgICAgIHRoaXMuaGlzdG9yeUxvYWRpbmcgPSB0cnVlOwogICAgICB0aGlzLmhpc3RvcnlMaXN0ID0gW107CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0QXR0ZW1wdEhpc3RvcnkoY291cnNlSWQpOwogICAgICAgIHRoaXMuaGlzdG9yeUxpc3QgPSByZXMuZGF0YSB8fCBbXTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnN0IG1zZyA9IGU/LnJlc3BvbnNlPy5kYXRhPy5tZXNzYWdlIHx8IGU/Lm1lc3NhZ2UgfHwgIuiOt+WPluWksei0pSI7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihtc2cpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMuaGlzdG9yeUxvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBvcGVuQ3JlYXRlKCkgewogICAgICB0aGlzLmNyZWF0ZUZvcm0gPSB7CiAgICAgICAgdGl0bGU6ICIiLAogICAgICAgIGNvbnRlbnQ6ICIiLAogICAgICAgIHN0YXJ0VGltZTogIiIsCiAgICAgICAgZW5kVGltZTogIiIsCiAgICAgICAgbW9kZTogIk9OTElORSIsCiAgICAgICAgcGFzc2luZ1Njb3JlOiA2MCwKICAgICAgICBkdXJhdGlvbk1pbnV0ZXM6IDMwCiAgICAgIH07CiAgICAgIHRoaXMuY3JlYXRlVmlzaWJsZSA9IHRydWU7CiAgICB9LAoKICAgIGFzeW5jIHN1Ym1pdENyZWF0ZSgpIHsKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCBjcmVhdGVUcmFpbmluZ0NvdXJzZSh0aGlzLmNyZWF0ZUZvcm0pOwogICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5Yib5bu65oiQ5YqfIik7CiAgICAgICAgdGhpcy5jcmVhdGVWaXNpYmxlID0gZmFsc2U7CiAgICAgICAgdGhpcy5sb2FkKCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zdCBtc2cgPSBlPy5yZXNwb25zZT8uZGF0YT8ubWVzc2FnZSB8fCBlPy5tZXNzYWdlIHx8ICLliJvlu7rlpLHotKUiOwogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IobXNnKTsKICAgICAgfQogICAgfQogIH0KfTsK"},{"version":3,"sources":["list.vue"],"names":[],"mappings":";AA2MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/modules/training","sourcesContent":["<template>\n  <div>\n    <el-card>\n\n      <div style=\"margin-bottom:16px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;\">\n        <el-button type=\"primary\" @click=\"load\">刷新</el-button>\n\n        <el-button\n            v-if=\"isAdmin\"\n            type=\"success\"\n            @click=\"openCreate\"\n        >\n          新建培训课程（Admin）\n        </el-button>\n      </div>\n\n      <el-table :data=\"rows\" border v-loading=\"loading\">\n        <el-table-column prop=\"id\" label=\"ID\" width=\"90\" />\n        <el-table-column prop=\"title\" label=\"课程标题\" />\n\n        <el-table-column label=\"操作\" width=\"420\">\n          <template slot-scope=\"scope\">\n            <el-button size=\"mini\" @click=\"openCourseDetail(scope.row.id)\">\n              查看详情\n            </el-button>\n\n            <el-button\n                v-if=\"isStudent\"\n                size=\"mini\"\n                type=\"primary\"\n                @click=\"enroll(scope.row.id)\"\n            >\n              报名\n            </el-button>\n\n            <el-button\n                v-if=\"isStudent\"\n                size=\"mini\"\n                type=\"success\"\n                @click=\"openQuiz(scope.row.id)\"\n            >\n              开始做题\n            </el-button>\n\n            <el-button\n                v-if=\"isStudent\"\n                size=\"mini\"\n                @click=\"openHistory(scope.row.id)\"\n            >\n              历史记录\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <el-pagination\n          style=\"margin-top:16px;\"\n          background\n          layout=\"total, sizes, prev, pager, next\"\n          :total=\"total\"\n          :page-size=\"size\"\n          :page-sizes=\"[10, 20, 50]\"\n          @current-change=\"changePage\"\n          @size-change=\"changeSize\"\n      />\n    </el-card>\n\n    <!-- course detail -->\n    <el-dialog title=\"课程详情\" :visible.sync=\"detailVisible\" width=\"760px\" v-loading=\"detailLoading\">\n      <el-descriptions :column=\"2\" border v-if=\"detail\">\n        <el-descriptions-item label=\"ID\">{{ detail.id }}</el-descriptions-item>\n        <el-descriptions-item label=\"标题\">{{ detail.title }}</el-descriptions-item>\n        <el-descriptions-item label=\"模式\">{{ detail.mode }}</el-descriptions-item>\n        <el-descriptions-item label=\"及格分\">{{ detail.passingScore }}</el-descriptions-item>\n        <el-descriptions-item label=\"开始时间\">{{ detail.startTime }}</el-descriptions-item>\n        <el-descriptions-item label=\"结束时间\">{{ detail.endTime }}</el-descriptions-item>\n        <el-descriptions-item label=\"时长(min)\">{{ detail.durationMinutes }}</el-descriptions-item>\n        <el-descriptions-item label=\"创建时间\">{{ detail.createdAt }}</el-descriptions-item>\n        <el-descriptions-item label=\"内容\" :span=\"2\">\n          <div style=\"white-space: pre-wrap;\">{{ detail.content }}</div>\n        </el-descriptions-item>\n      </el-descriptions>\n\n      <span slot=\"footer\">\n        <el-button @click=\"detailVisible=false\">关闭</el-button>\n      </span>\n    </el-dialog>\n\n    <!-- quiz dialog -->\n    <el-dialog\n        title=\"安全培训考试\"\n        :visible.sync=\"quizVisible\"\n        width=\"860px\"\n        :close-on-click-modal=\"false\"\n        v-loading=\"quizLoading\"\n    >\n      <div v-if=\"quizCourseId\">\n        <div style=\"margin-bottom: 10px;\">\n          课程ID：<b>{{ quizCourseId }}</b>\n          <span style=\"margin-left: 12px;\">AttemptID：<b>{{ quizAttemptId || '-' }}</b></span>\n        </div>\n\n        <div v-if=\"quizQuestions.length === 0 && !quizLoading\" style=\"padding: 12px 0;\">\n          暂无题目（后端未配置题库或接口返回为空）\n        </div>\n\n        <div v-for=\"q in quizQuestions\" :key=\"q.questionId\" style=\"margin-bottom: 16px;\">\n          <div style=\"font-weight: 600; margin-bottom: 8px;\">\n            {{ q.questionId }}. {{ q.questionText }}\n          </div>\n\n          <el-radio-group v-model=\"quizAnswers[q.questionId]\">\n            <div style=\"display:flex; flex-direction:column; gap:6px;\">\n              <el-radio :label=\"'A'\">A. {{ q.optionA }}</el-radio>\n              <el-radio :label=\"'B'\">B. {{ q.optionB }}</el-radio>\n              <el-radio :label=\"'C'\">C. {{ q.optionC }}</el-radio>\n              <el-radio :label=\"'D'\">D. {{ q.optionD }}</el-radio>\n            </div>\n          </el-radio-group>\n        </div>\n      </div>\n\n      <span slot=\"footer\">\n        <el-button @click=\"closeQuiz\">关闭</el-button>\n        <el-button\n            type=\"primary\"\n            :disabled=\"quizQuestions.length === 0 || !quizAttemptId\"\n            @click=\"submitQuiz\"\n        >\n          提交答案\n        </el-button>\n      </span>\n    </el-dialog>\n\n    <!-- history -->\n    <el-dialog title=\"考试历史\" :visible.sync=\"historyVisible\" width=\"760px\">\n      <el-table :data=\"historyList\" border v-loading=\"historyLoading\">\n        <el-table-column prop=\"id\" label=\"AttemptID\" width=\"100\" />\n        <el-table-column prop=\"courseTitle\" label=\"课程\" />\n        <el-table-column prop=\"startedAt\" label=\"开始时间\" width=\"180\" />\n        <el-table-column prop=\"submittedAt\" label=\"提交时间\" width=\"180\" />\n        <el-table-column prop=\"score\" label=\"得分\" width=\"90\" />\n        <el-table-column prop=\"passed\" label=\"通过\" width=\"90\" />\n      </el-table>\n\n      <span slot=\"footer\">\n        <el-button @click=\"historyVisible=false\">关闭</el-button>\n      </span>\n    </el-dialog>\n\n    <!-- create dialog（保留，不影响你UI习惯） -->\n    <el-dialog title=\"新建培训课程（Admin）\" :visible.sync=\"createVisible\" width=\"720px\">\n      <el-form :model=\"createForm\" label-width=\"120px\">\n        <el-form-item label=\"标题\">\n          <el-input v-model=\"createForm.title\" />\n        </el-form-item>\n\n        <el-form-item label=\"内容\">\n          <el-input type=\"textarea\" :rows=\"3\" v-model=\"createForm.content\" />\n        </el-form-item>\n\n        <el-form-item label=\"开始时间\">\n          <el-date-picker\n              v-model=\"createForm.startTime\"\n              type=\"datetime\"\n              value-format=\"yyyy-MM-ddTHH:mm:ss\"\n          />\n        </el-form-item>\n\n        <el-form-item label=\"结束时间\">\n          <el-date-picker\n              v-model=\"createForm.endTime\"\n              type=\"datetime\"\n              value-format=\"yyyy-MM-ddTHH:mm:ss\"\n          />\n        </el-form-item>\n\n        <el-form-item label=\"模式\">\n          <el-select v-model=\"createForm.mode\" style=\"width: 220px;\">\n            <el-option label=\"ONLINE\" value=\"ONLINE\" />\n            <el-option label=\"OFFLINE\" value=\"OFFLINE\" />\n          </el-select>\n        </el-form-item>\n\n        <el-form-item label=\"及格分\">\n          <el-input v-model=\"createForm.passingScore\" type=\"number\" />\n        </el-form-item>\n\n        <el-form-item label=\"考试时长(min)\">\n          <el-input v-model=\"createForm.durationMinutes\" type=\"number\" />\n        </el-form-item>\n      </el-form>\n\n      <span slot=\"footer\">\n        <el-button @click=\"createVisible=false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"submitCreate\">提交</el-button>\n      </span>\n    </el-dialog>\n\n  </div>\n</template>\n\n<script>\nimport {\n  listTrainingCourses,\n  getTrainingCourse,\n  createTrainingCourse,\n  enrollCourse,\n  getTrainingQuestions,\n  startAttempt,\n  submitAttempt,\n  getAttemptHistory\n} from \"@/api/training\";\n\nexport default {\n  data() {\n    return {\n      loading: false,\n      rows: [],\n      total: 0,\n      page: 1,\n      size: 10,\n\n      detailVisible: false,\n      detailLoading: false,\n      detail: null,\n\n      quizVisible: false,\n      quizLoading: false,\n      quizCourseId: null,\n      quizAttemptId: null,\n      quizQuestions: [],\n      quizAnswers: {},\n\n      historyVisible: false,\n      historyLoading: false,\n      historyList: [],\n\n      createVisible: false,\n      createForm: {\n        title: \"\",\n        content: \"\",\n        startTime: \"\",\n        endTime: \"\",\n        mode: \"ONLINE\",\n        passingScore: 60,\n        durationMinutes: 30\n      }\n    };\n  },\n\n  computed: {\n    role() {\n      return localStorage.getItem(\"Role\") || \"\";\n    },\n    isAdmin() {\n      return this.role === \"ADMIN\";\n    },\n    isStudent() {\n      return this.role === \"STUDENT\";\n    }\n  },\n\n  mounted() {\n    this.load();\n  },\n\n  methods: {\n    dash(v) {\n      // keep UI unchanged; just avoid empty cells\n      if (v === null || v === undefined) return \"-\";\n      const s = String(v);\n      return s.trim() === \"\" ? \"-\" : v;\n    },\n\n    normalizeCourse(raw) {\n      const c = raw || {};\n      // 兼容：后端可能只返回 id/title，或字段名不同\n      return {\n        id: this.dash(c.id),\n        title: this.dash(c.title || c.name),\n\n        mode: this.dash(c.mode),\n        passingScore: this.dash(c.passingScore),\n\n        startTime: this.dash(c.startTime),\n        endTime: this.dash(c.endTime),\n\n        durationMinutes: this.dash(c.durationMinutes),\n\n        createdAt: this.dash(c.createdAt),\n\n        content: this.dash(c.content || c.description || c.details)\n      };\n    },\n\n    async load() {\n      this.loading = true;\n      try {\n        const res = await listTrainingCourses({ page: this.page - 1, size: this.size });\n        const data = res.data || {};\n        this.rows = data.content || [];\n        this.total = Number(data.totalElements || 0);\n      } catch (e) {\n        const msg = e?.response?.data?.message || e?.message || \"加载失败\";\n        this.$message.error(\"课程加载失败：\" + msg);\n        this.rows = [];\n        this.total = 0;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    changePage(p) {\n      this.page = p;\n      this.load();\n    },\n\n    changeSize(s) {\n      this.size = s;\n      this.page = 1;\n      this.load();\n    },\n\n    async openCourseDetail(courseId) {\n      this.detailVisible = true;\n      this.detailLoading = true;\n      this.detail = null;\n\n      try {\n        const res = await getTrainingCourse(courseId);\n        this.detail = this.normalizeCourse(res.data);\n      } catch (e) {\n        const msg = e?.response?.data?.message || e?.message || \"获取失败\";\n        this.$message.error(msg);\n      } finally {\n        this.detailLoading = false;\n      }\n    },\n\n    async enroll(courseId) {\n      try {\n        await enrollCourse(courseId);\n        this.$message.success(\"报名成功\");\n      } catch (e) {\n        const msg = e?.response?.data?.message || e?.message || \"报名失败\";\n        this.$message.error(msg);\n      }\n    },\n\n    async openQuiz(courseId) {\n      this.quizVisible = true;\n      this.quizLoading = true;\n\n      this.quizCourseId = courseId;\n      this.quizAttemptId = null;\n      this.quizQuestions = [];\n      this.quizAnswers = {};\n\n      try {\n        const qRes = await getTrainingQuestions(courseId);\n        const list = Array.isArray(qRes.data) ? qRes.data : (qRes.data?.content || []);\n        this.quizQuestions = (list || []).filter(x => x && x.questionId != null);\n\n        const ans = {};\n        this.quizQuestions.forEach(q => { ans[q.questionId] = \"\"; });\n        this.quizAnswers = ans;\n\n        const aRes = await startAttempt(courseId);\n        this.quizAttemptId = aRes.data?.id;\n\n      } catch (e) {\n        const msg = e?.response?.data?.message || e?.message || \"打开失败\";\n        this.$message.error(\"打开考试失败：\" + msg);\n      } finally {\n        this.quizLoading = false;\n      }\n    },\n\n    closeQuiz() {\n      this.quizVisible = false;\n      this.quizCourseId = null;\n      this.quizAttemptId = null;\n      this.quizQuestions = [];\n      this.quizAnswers = {};\n    },\n\n    async submitQuiz() {\n      if (!this.quizAttemptId) {\n        this.$message.error(\"attemptId 为空\");\n        return;\n      }\n\n      const payload = {};\n      this.quizQuestions.forEach(q => {\n        const v = this.quizAnswers[q.questionId];\n        if (v) payload[String(q.questionId)] = String(v).trim().toUpperCase();\n      });\n\n      try {\n        await submitAttempt(this.quizAttemptId, payload);\n        this.$message.success(\"提交成功\");\n        this.closeQuiz();\n      } catch (e) {\n        const msg = e?.response?.data?.message || e?.message || \"提交失败\";\n        this.$message.error(msg);\n      }\n    },\n\n    async openHistory(courseId) {\n      this.historyVisible = true;\n      this.historyLoading = true;\n      this.historyList = [];\n      try {\n        const res = await getAttemptHistory(courseId);\n        this.historyList = res.data || [];\n      } catch (e) {\n        const msg = e?.response?.data?.message || e?.message || \"获取失败\";\n        this.$message.error(msg);\n      } finally {\n        this.historyLoading = false;\n      }\n    },\n\n    openCreate() {\n      this.createForm = {\n        title: \"\",\n        content: \"\",\n        startTime: \"\",\n        endTime: \"\",\n        mode: \"ONLINE\",\n        passingScore: 60,\n        durationMinutes: 30\n      };\n      this.createVisible = true;\n    },\n\n    async submitCreate() {\n      try {\n        await createTrainingCourse(this.createForm);\n        this.$message.success(\"创建成功\");\n        this.createVisible = false;\n        this.load();\n      } catch (e) {\n        const msg = e?.response?.data?.message || e?.message || \"创建失败\";\n        this.$message.error(msg);\n      }\n    }\n  }\n};\n</script>\n"]}]}